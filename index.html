<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>URBAKER | ìœ ì–´ë² ì´ì»¤ ì˜ˆì•½</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Firebase SDK (v9 compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@700;900&family=Inter:wght@400;700;900&display=swap');
        :root { --brand: #63391d; --bg: #F8F5F0; }
        body { background-color: var(--bg); font-family: 'Inter', sans-serif; color: #332211; }
        .font-serif-kr { font-family: 'Noto Serif KR', serif; }
        .btn-primary { background-color: var(--brand); }
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* í„°ì¹˜ íƒ€ê²Ÿ ìµœì í™” */
        input, select, button { font-size: 16px !important; } 
    </style>
</head>
<body class="flex flex-col items-center min-h-screen">
    <div id="app" class="max-w-md w-full min-h-screen flex flex-col bg-white shadow-2xl overflow-hidden">
        
        <!-- í—¤ë” -->
        <header class="p-6 flex justify-between items-center border-b border-stone-50">
            <div>
                <h1 class="font-serif-kr text-3xl font-black text-[#63391d] italic cursor-pointer" onclick="location.reload()">URBAKER</h1>
                <p class="text-[9px] font-bold tracking-[0.2em] text-[#63391d]/50 uppercase">Artisan Financier Shop</p>
            </div>
            <button id="adminBtn" class="p-2 text-stone-200 hover:text-stone-400 transition-colors">
                <i data-lucide="settings" class="w-5 h-5"></i>
            </button>
        </header>

        <!-- ì˜ˆì•½ í™”ë©´ -->
        <main id="order-view" class="p-6 space-y-6 fade-in flex-grow overflow-y-auto">
            <div class="text-center py-4">
                <h2 class="text-xl font-bold">íœ˜ë‚­ì‹œì— ì˜ˆì•½ ì‹ ì²­</h2>
                <p class="text-xs text-stone-400 mt-1">í”½ì—… í¬ë§ì¼ê³¼ ë©”ë‰´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</p>
            </div>

            <div class="space-y-4">
                <input type="text" id="user-name" placeholder="ì˜ˆì•½ì ì„±í•¨" class="w-full p-4 rounded-2xl bg-stone-50 border-none font-bold text-sm outline-none focus:ring-2 focus:ring-[#63391d]/10">
                <input type="tel" id="user-phone" placeholder="ì—°ë½ì²˜ (010-0000-0000)" class="w-full p-4 rounded-2xl bg-stone-50 border-none font-bold text-sm outline-none focus:ring-2 focus:ring-[#63391d]/10">
                <select id="user-date" class="w-full p-4 rounded-2xl bg-stone-50 border-none font-bold text-sm appearance-none outline-none focus:ring-2 focus:ring-[#63391d]/10">
                    <option value="">ìˆ˜ë ¹ í¬ë§ì¼ ì„ íƒ</option>
                    <option value="02ì›” 26ì¼ (ëª©)">02ì›” 26ì¼ (ëª©)</option>
                    <option value="02ì›” 27ì¼ (ê¸ˆ)">02ì›” 27ì¼ (ê¸ˆ)</option>
                    <option value="02ì›” 28ì¼ (í† )">02ì›” 28ì¼ (í† )</option>
                </select>
            </div>

            <div id="menu-list" class="space-y-4 py-4">
                <!-- ë©”ë‰´ ì•„ì´í…œ (JS ë Œë”ë§) -->
            </div>

            <div class="p-6 bg-stone-50 rounded-3xl space-y-4">
                <div class="flex justify-between items-center">
                    <span class="text-xs font-bold text-stone-400 uppercase">Total Amount</span>
                    <span id="total-price" class="text-2xl font-black text-[#63391d]">0ì›</span>
                </div>
                <button id="submitBtn" onclick="submitOrder()" class="w-full py-5 btn-primary text-white rounded-2xl font-black shadow-lg active:scale-[0.98] transition-transform">
                    ì˜ˆì•½ í™•ì •í•˜ê¸°
                </button>
            </div>
        </main>

        <!-- ê´€ë¦¬ì í™”ë©´ -->
        <main id="admin-view" class="fixed inset-0 bg-white z-[100] p-6 hidden overflow-y-auto">
            <div class="flex justify-between items-center mb-8">
                <h2 class="font-serif-kr text-2xl font-black italic">Orders</h2>
                <button onclick="document.getElementById('admin-view').classList.add('hidden')" class="p-2 bg-stone-100 rounded-full"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <div id="admin-orders-list" class="space-y-4 pb-20"></div>
        </main>
    </div>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-stone-900 text-white px-6 py-3 rounded-full text-sm font-bold opacity-0 transition-opacity z-[200] pointer-events-none"></div>

    <script>
        // íŒŒì´ì–´ë² ì´ìŠ¤ ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyDSswqgDFO8yshyb14lan3JhnrAlZc_tyQ",
            authDomain: "urbaker-32276.firebaseapp.com",
            projectId: "urbaker-32276",
            storageBucket: "urbaker-32276.firebasestorage.app",
            messagingSenderId: "775330988751",
            appId: "1:775330988751:web:d7a32a3a4677592fb8adba",
            measurementId: "G-05KWZGQWRW"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        const store = {
            products: [
                {id:1, name:"ì†”í‹° ì´ˆì½” íœ˜ë‚­ì‹œì—", price:3500},
                {id:2, name:"ë§ì°¨ íœ˜ë‚­ì‹œì—", price:3500},
                {id:3, name:"ì¸„ëŸ¬ìŠ¤ íœ˜ë‚­ì‹œì—", price:3500},
                {id:4, name:"ì–¼ê·¸ë ˆì´ íœ˜ë‚­ì‹œì—", price:3500}
            ]
        };
        let cart = {};

        function init() {
            auth.signInAnonymously().catch(e => console.log("Auth wait..."));
            renderMenu();
            lucide.createIcons();
            setupAdmin();
        }

        function renderMenu() {
            const list = document.getElementById('menu-list');
            list.innerHTML = store.products.map(p => `
                <div class="flex justify-between items-center py-1">
                    <div>
                        <p class="font-bold text-stone-800 text-sm">${p.name}</p>
                        <p class="text-xs text-[#63391d] font-black">${p.price.toLocaleString()}ì›</p>
                    </div>
                    <div class="flex items-center gap-3 bg-stone-50 p-1 rounded-xl border border-stone-100">
                        <button onclick="updateQty(${p.id}, -1)" class="w-8 h-8 rounded-lg bg-white shadow-sm font-black text-[#63391d]">-</button>
                        <span id="qty-${p.id}" class="text-sm font-black w-4 text-center">0</span>
                        <button onclick="updateQty(${p.id}, 1)" class="w-8 h-8 rounded-lg bg-white shadow-sm font-black text-[#63391d]">+</button>
                    </div>
                </div>
            `).join('');
        }

        function updateQty(id, delta) {
            cart[id] = Math.max(0, (cart[id] || 0) + delta);
            document.getElementById(`qty-${id}`).innerText = cart[id];
            let total = 0;
            store.products.forEach(p => total += (cart[p.id] || 0) * p.price);
            document.getElementById('total-price').innerText = total.toLocaleString() + 'ì›';
        }

        async function submitOrder() {
            const btn = document.getElementById('submitBtn');
            const name = document.getElementById('user-name').value.trim();
            const phone = document.getElementById('user-phone').value.trim();
            const date = document.getElementById('user-date').value;
            
            if(!name || !phone || !date) return alert("ì˜ˆì•½ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!");

            const items = store.products.filter(p => cart[p.id] > 0).map(p => ({ name: p.name, qty: cart[p.id] }));
            if(items.length === 0) return alert("ë©”ë‰´ë¥¼ í•˜ë‚˜ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”!");

            btn.disabled = true;
            btn.innerText = "ì ‘ìˆ˜ ì¤‘...";

            try {
                await db.collection("orders").add({
                    name, phone, date, items,
                    total: document.getElementById('total-price').innerText,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                alert("ì˜ˆì•½ì´ ì •ìƒì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ¥¯");
                location.reload();
            } catch(e) {
                alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”: " + e.message);
                btn.disabled = false;
                btn.innerText = "ì˜ˆì•½ í™•ì •í•˜ê¸°";
            }
        }

        function setupAdmin() {
            document.getElementById('adminBtn').onclick = () => {
                const pw = prompt("ê´€ë¦¬ì ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
                if(pw === "9926") {
                    document.getElementById('admin-view').classList.remove('hidden');
                    db.collection("orders").orderBy("createdAt", "desc").onSnapshot(snap => {
                        const list = document.getElementById('admin-orders-list');
                        list.innerHTML = '';
                        if(snap.empty) list.innerHTML = '<p class="text-center py-10 text-stone-300">ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                        snap.forEach(doc => {
                            const o = doc.data();
                            list.innerHTML += `
                                <div class="p-5 bg-stone-50 rounded-2xl border border-stone-100 mb-4 shadow-sm">
                                    <div class="flex justify-between items-start mb-2">
                                        <p class="font-black text-lg text-stone-900">${o.name}</p>
                                        <span class="text-[10px] font-black bg-[#63391d] text-white px-2 py-1 rounded-md">${o.date}</span>
                                    </div>
                                    <p class="text-xs font-bold text-stone-400 mb-3">${o.phone}</p>
                                    <div class="bg-white p-4 rounded-xl text-xs space-y-2">
                                        ${o.items.map(i => `<div class="flex justify-between"><span>${i.name}</span><b class="text-[#63391d]">${i.qty}ê°œ</b></div>`).join('')}
                                        <div class="pt-2 mt-2 border-t border-stone-50 flex justify-between font-black text-stone-900">
                                            <span>í•©ê³„</span>
                                            <span>${o.total}</span>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                    });
                }
            };
        }
        init();
    </script>
</body>
</html>